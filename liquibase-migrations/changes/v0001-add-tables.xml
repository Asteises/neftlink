<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">
<changeSet id="v0001-add-tables.xml" author="asteises">
    <preConditions onFail="MARK_RAN">
        <not>
            <tableExists tableName="base"/>
            <tableExists tableName="gas"/>
            <tableExists tableName="order"/>
            <tableExists tableName="role"/>
            <tableExists tableName="users"/>
            <tableExists tableName="user_roles"/>
        </not>
    </preConditions>

    <createTable tableName="base">
    <column name="id" type="UUID">
            <constraints primaryKey="true" nullable="false"/>
    </column>
        <column name ="name" type="VARCHAR(100)">
            <constraints unique="true" nullable="false"/>
        </column>
        <column name ="address" type="VARCHAR(200)"/>
        <column name="is_visible" type="boolean"/>
    </createTable>

    <createTable tableName="gas">
        <column name="id" type="UUID">
            <constraints primaryKey="true" nullable="false"/>
        </column>
        <column name ="gas_type" type="VARCHAR(100)">
            <constraints unique="true" nullable="false"/>
        </column>
        <column name="is_visible" type="boolean"/>
    </createTable>

    <createTable tableName="orders">
        <column name="id" type="UUID">
        <constraints primaryKey="true" nullable="false"/>
        </column>
        <column name="cost" type="BIGINT"/>
        <column name="create_date" type="TIMESTAMP">
            <constraints nullable="false"/>
        </column>
        <column name="update_date" type="TIMESTAMP"/>
        <column name="gas_id" type="UUID">
            <constraints nullable="false"/>
        </column>
        <column name="base_id" type="UUID">
            <constraints nullable="false"/>
        </column>
        <column name="user_id" type="UUID">
            <constraints nullable="false"/>
        </column>
        <column name="is_visible" type="boolean"/>
     </createTable>

    <createTable tableName="users">
        <column name="id" type="UUID">
            <constraints primaryKey="true" nullable="false"/>
        </column>
        <column name="surname" type="VARCHAR(50)"/>
        <column name="firstname" type="VARCHAR(50)"/>
        <column name="lastname" type="VARCHAR(50)"/>
        <column name="inn" type="INTEGER(12)">
            <constraints unique="true" nullable="false"/>
        </column>
        <column name="phone" type="VARCHAR(10)">
            <constraints unique="true" nullable="false"/>
        </column>
        <column name="email" type="VARCHAR(50)">
            <constraints unique="true" nullable="false"/>
        </column>
        <column name="password" type="VARCHAR(200)">
            <constraints nullable="false"/>
        </column>
        <column name="company" type="VARCHAR(100)"/>
    </createTable>

    <createTable tableName="role">
        <column name="id" type="UUID">
            <constraints primaryKey="true" nullable="false"/>
        </column>
        <column name ="role_name" type="VARCHAR(15)">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <createTable tableName="users_roles">
        <column name="user_id" type="UUID">
            <constraints nullable="false"/>
        </column>
        <column name ="role_id" type="UUID">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <!--
    baseTableName - table in
    baseColumnNames - column in
    constraintName - just name
    referencedTableName - from table
    referencedColumnNames - from column
    -->

    <addForeignKeyConstraint baseTableName="order" baseColumnNames="base_id" constraintName="fk_order_base_id" referencedTableName="base"
                             referencedColumnNames="id"/>
    <addForeignKeyConstraint baseTableName="order" baseColumnNames="gas_id" constraintName="fk_order_gas_id" referencedTableName="gas"
                             referencedColumnNames="id"/>
    <addForeignKeyConstraint baseTableName="users_roles" baseColumnNames="role_id" constraintName="fk_users_role_id" referencedTableName="role"
                             referencedColumnNames="id"/>
    <addForeignKeyConstraint baseTableName="users_roles" baseColumnNames="user_id" constraintName="fk_role_users_id" referencedTableName="users"
                             referencedColumnNames="id"/>

    <insert tableName="role">
        <column name="id" value="123e4567-e89b-12d3-a456-426655440000"/>
        <column name="role_name" value="ADMIN"/>
    </insert>
    <insert tableName="role">
        <column name="id" value="223e4567-e89b-12d3-a456-426655440000"/>
        <column name="role_name" value="USER"/>
    </insert>
    <insert tableName="users">
        <column name="id" value="323e4567-e89b-12d3-a456-426655440000"/>
        <column name="company" value="NEFTLINK"/>
        <column name="email" value="admin@neftlink.ru"/>
        <column name="inn" value="77777777"/>
        <column name="name" value="Admin"/>
        <column name="password" value="$2a$08$WCAY6v2fN5AkjSHi9EGkIOs3C9tQze.L/rwPHht/g2rE/ZQxLUFyq"/>
    </insert>
    <insert tableName="users_roles">
        <column name="user_id" value="323e4567-e89b-12d3-a456-426655440000"/>
        <column name="role_id" value="123e4567-e89b-12d3-a456-426655440000"/>
    </insert>
</changeSet>



</databaseChangeLog>
